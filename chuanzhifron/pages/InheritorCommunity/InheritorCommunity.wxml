<!--InheritorCommunit.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜å’Œæœç´¢ -->
  <view class="page-header">
    <view class="header-top">
      <text class="page-title">ä¼ æ‰¿äººç¤¾åŒº</text>
      <button class="search-btn" bindtap="onSearch" style="width: 249rpx; display: flex; box-sizing: border-box; left: 0rpx; top: 0rpx">
        <text class="iconfont icon-search">ğŸ”</text>
      </button>
      <button class="share-btn" bindtap="onShare" style="width: 172rpx; display: flex; box-sizing: border-box; left: 0rpx; top: 0rpx">
        <text class="iconfont icon-share">ğŸ“¤</text>
      </button>
    </view>
    <!-- åˆ†ç±»ç­›é€‰ -->
    <scroll-view scroll-x="true" class="filter-scroll" wx:if="{{showFilters}}">
      <view class="filter-list">
        <view class="filter-item {{currentCategory === 'all' ? 'active' : ''}}" 
              data-category="all" bindtap="onCategoryFilter">
          <text>å…¨éƒ¨</text>
        </view>
        <view class="filter-item {{currentCategory === 'suxiu' ? 'active' : ''}}" 
              data-category="suxiu" bindtap="onCategoryFilter">
          <text>è‹ç»£</text>
        </view>
        <view class="filter-item {{currentCategory === 'jingtai' ? 'active' : ''}}" 
              data-category="jingtai" bindtap="onCategoryFilter">
          <text>æ™¯æ³°è“</text>
        </view>
        <view class="filter-item {{currentCategory === 'jianzhi' ? 'active' : ''}}" 
              data-category="jianzhi" bindtap="onCategoryFilter">
          <text>å‰ªçº¸</text>
        </view>
        <view class="filter-item {{currentCategory === 'jingju' ? 'active' : ''}}" 
              data-category="jingju" bindtap="onCategoryFilter">
          <text>äº¬å‰§</text>
        </view>
        <view class="filter-item {{currentCategory === 'junci' ? 'active' : ''}}" 
              data-category="junci" bindtap="onCategoryFilter">
          <text>é’§ç“·</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ä¼ æ‰¿äººæ¨è -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">å›½å®¶çº§ä¼ æ‰¿äºº</text>
      <view class="section-header-right">
        <text class="section-count" wx:if="{{masterList.length > 0}}">{{masterList.length}}ä½</text>
        <navigator url="/pages/masterList/masterList?category={{currentCategory}}" class="more-link" wx:if="{{masterList.length > 4}}">æŸ¥çœ‹æ›´å¤š</navigator>
      </view>
    </view>
    <view class="master-grid" wx:if="{{displayMasterList.length > 0}}">
      <view class="master-card card card-hover" 
            wx:for="{{displayMasterList}}" 
            wx:key="id" 
            bindtap="onMasterTap" 
            data-item="{{item}}">
        <image src="{{item.avatar || item.image}}" class="master-image" mode="aspectFill"></image>
        <view class="master-content">
          <view class="master-header">
            <text class="master-name">{{item.name}}</text>
            <view class="master-header-right">
              <view class="master-level">{{item.title || item.level || 'å›½å®¶çº§ä¼ æ‰¿äºº'}}</view>
              <button class="favorite-btn" bindtap="toggleFavorite" data-item="{{item}}" catchtap="true">
                <text class="iconfont {{item.isFavorite ? 'icon-heart-fill' : 'icon-heart'}}"></text>
              </button>
            </view>
          </view>
          <text class="master-skill">{{item.skill}}</text>
          <text class="master-desc">{{item.introduction || item.description || 'æš‚æ— ä»‹ç»'}}</text>
        </view>
        <view class="master-footer">
          <button class="btn-secondary book-button" bindtap="bookExperience" data-item="{{item}}" catchtap="true">
            é¢„çº¦ä½“éªŒ
          </button>
          <button class="btn-outline share-master-btn" bindtap="shareMaster" data-item="{{item}}" catchtap="true">
            åˆ†äº«
          </button>
        </view>
      </view>
    </view>
    <view wx:if="{{displayMasterList.length === 0 && !loading}}" class="empty">
      <text class="empty-text">æš‚æ— ä¼ æ‰¿äººä¿¡æ¯</text>
    </view>
  </view>

  <!-- æŠ€è‰ºå±•ç¤º -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">æŠ€è‰ºå±•ç¤º</text>
    </view>
    <view class="skill-grid" wx:if="{{skillVideos.length > 0}}">
      <view class="skill-card card card-hover" 
            wx:for="{{skillVideos}}" 
            wx:key="id" 
            bindtap="onVideoTap" 
            data-item="{{item}}">
        <view class="video-container">
          <image src="{{item.thumbnail}}" class="video-thumbnail" mode="aspectFill"></image>
          <view class="play-overlay">
            <text class="play-icon">â–¶</text>
          </view>
          <view class="video-duration">{{item.duration}}</view>
        </view>
        <view class="skill-content">
          <text class="skill-title">{{item.title}}</text>
          <text class="skill-desc">{{item.description}}</text>
          <view class="skill-footer">
            <text class="skill-date">{{item.date}}</text>
            <text class="skill-views">{{item.views}}æ¬¡è§‚çœ‹</text>
          </view>
        </view>
      </view>
    </view>
    <view wx:if="{{skillVideos.length === 0 && !loading}}" class="empty">
      <text class="empty-text">æš‚æ— è§†é¢‘å†…å®¹</text>
    </view>
  </view>

  <!-- ç¤¾åŒºæ´»åŠ¨ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">è¿‘æœŸæ´»åŠ¨</text>
    </view>
    <view class="activity-list" wx:if="{{activities.length > 0}}">
      <view class="activity-item" wx:for="{{activities}}" wx:key="id">
        <view class="activity-date">
          <text class="date-day">{{item.day}}</text>
          <text class="date-month">{{item.month}}</text>
        </view>
        <view class="activity-content">
          <text class="activity-title">{{item.title}}</text>
          <text class="activity-time">{{item.time}}</text>
          <text class="activity-location">{{item.location}}</text>
        </view>
        <button class="btn-primary activity-button" bindtap="joinActivity" data-item="{{item}}">
          {{item.buttonText}}
        </button>
      </view>
    </view>
    <view wx:if="{{activities.length === 0 && !loading}}" class="empty">
      <text class="empty-text">æš‚æ— æ´»åŠ¨ä¿¡æ¯</text>
    </view>
  </view>

  <!-- ç¤¾åŒºåŠ¨æ€ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">ç¤¾åŒºåŠ¨æ€</text>
      <text class="more-link" bindtap="viewMorePosts">æŸ¥çœ‹æ›´å¤š</text>
    </view>
    <view class="community-list" wx:if="{{communityPosts.length > 0}}">
      <view class="community-item card card-hover" wx:for="{{communityPosts}}" wx:key="id">
        <image src="{{item.avatar}}" class="user-avatar" mode="aspectFill"></image>
        <view class="post-content">
          <view class="post-header">
            <text class="user-name">{{item.userName}}</text>
            <text class="post-time">{{item.time}}</text>
          </view>
          <text class="post-text">{{item.content}}</text>
          <view wx:if="{{item.images.length > 0}}" class="post-images">
            <image wx:for="{{item.images}}" wx:for-item="img" wx:key="*this" 
                   src="{{img}}" class="post-image" mode="aspectFill"></image>
          </view>
          <view class="post-footer">
            <button class="action-btn" bindtap="likePost" data-item="{{item}}" catchtap="true">
              <text class="iconfont {{item.isLiked ? 'icon-heart-fill' : 'icon-heart'}}"></text>
              <text>{{item.likes}}</text>
            </button>
            <button class="action-btn" bindtap="commentPost" data-item="{{item}}" catchtap="true">
              <text class="iconfont icon-comment">ğŸ’¬</text>
              <text>{{item.comments}}</text>
            </button>
          </view>
        </view>
      </view>
    </view>
    <view wx:if="{{communityPosts.length === 0 && !loading}}" class="empty">
      <text class="empty-text">æš‚æ— ç¤¾åŒºåŠ¨æ€</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
