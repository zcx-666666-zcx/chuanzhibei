# 注册与登录功能测试案例

## 1. 概述

本文档提供了注册与登录功能的详细测试案例，供后端开发人员参考和验证接口实现。这些测试案例覆盖了正常流程、边界条件和异常情况。

## 2. 测试环境

- 测试工具：Postman / Swagger UI / JMeter 或其他API测试工具
- 请求基础地址：`http://localhost:8080/api`
- Content-Type：`application/json`

## 3. 用户注册功能测试

### 3.1 正常注册测试

**测试案例编号：** REG_001

**测试目的：** 验证用户可以使用有效的用户名、密码和邮箱成功注册

**前置条件：** 
- 数据库中不存在相同用户名的用户

**测试步骤：**
1. 发送POST请求到 `/auth/register`
2. 请求体包含：
```json
{
  "username": "testuser",
  "password": "Test123456",
  "email": "testuser@example.com"
}
```

**预期结果：**
- HTTP状态码：200
- 响应体：
```json
{
  "success": true,
  "message": "注册成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "testuser@example.com"
    }
  }
}
```
- 数据库中新增一条用户记录

### 3.2 重复用户名注册测试

**测试案例编号：** REG_002

**测试目的：** 验证当用户尝试使用已被占用的用户名注册时系统能正确处理

**前置条件：** 
- 数据库中已存在用户名为"testuser"的用户

**测试步骤：**
1. 发送POST请求到 `/auth/register`
2. 请求体包含：
```json
{
  "username": "testuser",
  "password": "AnotherPass123",
  "email": "another@example.com"
}
```

**预期结果：**
- HTTP状态码：400 或 200（取决于具体实现）
- 响应体：
```json
{
  "success": false,
  "error": "用户名已被占用"
}
```
- 数据库中用户记录数量不变

### 3.3 缺少必填字段测试

**测试案例编号：** REG_003

**测试目的：** 验证当缺少必填字段时系统能正确处理

**前置条件：** 无

**测试步骤：**
1. 发送POST请求到 `/auth/register`
2. 请求体包含（缺少password）：
```json
{
  "username": "incompleteuser",
  "email": "incomplete@example.com"
}
```

**预期结果：**
- HTTP状态码：400
- 响应体：
```json
{
  "success": false,
  "error": "密码不能为空"
}
```
- 数据库中用户记录数量不变

### 3.4 密码强度验证测试

**测试案例编号：** REG_004

**测试目的：** 验证密码强度校验功能

**前置条件：** 无

**测试步骤：**
1. 发送POST请求到 `/auth/register`
2. 请求体包含（密码过于简单）：
```json
{
  "username": "weakpassuser",
  "password": "123",
  "email": "weak@example.com"
}
```

**预期结果：**
- HTTP状态码：400
- 响应体：
```json
{
  "success": false,
  "error": "密码长度不能少于6位，且必须包含字母和数字"
}
```
- 数据库中用户记录数量不变

### 3.5 邮箱格式验证测试

**测试案例编号：** REG_005

**测试目的：** 验证邮箱格式校验功能

**前置条件：** 无

**测试步骤：**
1. 发送POST请求到 `/auth/register`
2. 请求体包含（无效邮箱格式）：
```json
{
  "username": "invalidemailuser",
  "password": "ValidPass123",
  "email": "invalid-email"
}
```

**预期结果：**
- HTTP状态码：400
- 响应体：
```json
{
  "success": false,
  "error": "邮箱格式不正确"
}
```
- 数据库中用户记录数量不变

## 4. 用户登录功能测试

### 4.1 用户名密码登录成功测试

**测试案例编号：** LOGIN_001

**测试目的：** 验证用户可以使用正确的用户名和密码成功登录

**前置条件：** 
- 数据库中存在用户名为"testuser"，密码为"Test123456"的用户

**测试步骤：**
1. 发送POST请求到 `/auth/login`
2. 请求体包含：
```json
{
  "username": "testuser",
  "password": "Test123456"
}
```

**预期结果：**
- HTTP状态码：200
- 响应体：
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "testuser@example.com",
      "nickName": "测试用户",
      "avatarUrl": "https://example.com/avatar.jpg"
    }
  }
}
```

### 4.2 用户名不存在测试

**测试案例编号：** LOGIN_002

**测试目的：** 验证当用户名不存在时系统能正确处理

**前置条件：** 
- 数据库中不存在用户名为"nonexistent"的用户

**测试步骤：**
1. 发送POST请求到 `/auth/login`
2. 请求体包含：
```json
{
  "username": "nonexistent",
  "password": "SomePass123"
}
```

**预期结果：**
- HTTP状态码：400 或 401
- 响应体：
```json
{
  "success": false,
  "error": "用户名或密码错误"
}
```

### 4.3 密码错误测试

**测试案例编号：** LOGIN_003

**测试目的：** 验证当密码错误时系统能正确处理

**前置条件：** 
- 数据库中存在用户名为"testuser"，密码为"Test123456"的用户

**测试步骤：**
1. 发送POST请求到 `/auth/login`
2. 请求体包含：
```json
{
  "username": "testuser",
  "password": "WrongPassword"
}
```

**预期结果：**
- HTTP状态码：400 或 401
- 响应体：
```json
{
  "success": false,
  "error": "用户名或密码错误"
}
```

### 4.4 缺少登录字段测试

**测试案例编号：** LOGIN_004

**测试目的：** 验证当缺少必要登录字段时系统能正确处理

**前置条件：** 无

**测试步骤：**
1. 发送POST请求到 `/auth/login`
2. 请求体包含（缺少password）：
```json
{
  "username": "testuser"
}
```

**预期结果：**
- HTTP状态码：400
- 响应体：
```json
{
  "success": false,
  "error": "用户名和密码不能为空"
}
```

## 5. 微信登录功能测试

### 5.1 微信登录成功测试

**测试案例编号：** WX_LOGIN_001

**测试目的：** 验证用户可以通过微信授权信息成功登录

**前置条件：** 
- 拥有有效的微信登录code

**测试步骤：**
1. 发送POST请求到 `/auth/login`
2. 请求体包含：
```json
{
  "openid": "valid_openid_from_wechat",
  "nickname": "微信用户",
  "avatarUrl": "https://thirdwx.qlogo.cn/mmopen/vi_32/xxx",
  "gender": 1,
  "country": "中国",
  "province": "北京",
  "city": "北京",
  "language": "zh_CN"
}
```

**预期结果：**
- HTTP状态码：200
- 响应体：
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 2,
      "openid": "valid_openid_from_wechat",
      "nickName": "微信用户",
      "avatarUrl": "https://thirdwx.qlogo.cn/mmopen/vi_32/xxx",
      "gender": 1,
      "country": "中国",
      "province": "北京",
      "city": "北京",
      "language": "zh_CN"
    }
  }
}
```

### 5.2 微信登录新用户注册测试

**测试案例编号：** WX_LOGIN_002

**测试目的：** 验证首次使用微信登录的用户能自动注册并登录

**前置条件：** 
- 数据库中不存在openid为"new_wechat_user_openid"的用户

**测试步骤：**
1. 发送POST请求到 `/auth/login`
2. 请求体包含：
```json
{
  "openid": "new_wechat_user_openid",
  "nickname": "新微信用户",
  "avatarUrl": "https://thirdwx.qlogo.cn/mmopen/vi_32/yyy"
}
```

**预期结果：**
- HTTP状态码：200
- 响应体包含新生成的token和用户信息
- 数据库中新增一条用户记录

## 6. Token验证测试

### 6.1 有效Token测试

**测试案例编号：** TOKEN_001

**测试目的：** 验证使用有效token可以访问受保护的资源

**前置条件：** 
- 拥有一个有效的JWT token

**测试步骤：**
1. 发送GET请求到任意需要认证的接口（如 `/user/profile`）
2. 在Header中添加：
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**预期结果：**
- HTTP状态码：200
- 返回请求的资源数据

### 6.2 无效Token测试

**测试案例编号：** TOKEN_002

**测试目的：** 验证使用无效token无法访问受保护的资源

**前置条件：** 
- 使用一个无效或过期的JWT token

**测试步骤：**
1. 发送GET请求到任意需要认证的接口（如 `/user/profile`）
2. 在Header中添加：
```
Authorization: Bearer invalid_token_string
```

**预期结果：**
- HTTP状态码：401
- 响应体：
```json
{
  "success": false,
  "error": "无效的认证令牌"
}
```

### 6.3 缺少Token测试

**测试案例编号：** TOKEN_003

**测试目的：** 验证未提供token无法访问受保护的资源

**前置条件：** 
- 不在请求Header中添加Authorization字段

**测试步骤：**
1. 发送GET请求到任意需要认证的接口（如 `/user/profile`）

**预期结果：**
- HTTP状态码：401
- 响应体：
```json
{
  "success": false,
  "error": "缺少认证令牌"
}
```

## 7. 性能测试建议

### 7.1 并发登录测试
- 模拟100个用户同时登录
- 响应时间应在合理范围内（建议小于1秒）
- 系统不应出现崩溃或严重性能下降

### 7.2 大量注册测试
- 模拟大量用户注册场景
- 验证数据库写入性能
- 确保用户名唯一性约束正常工作

## 8. 安全性测试建议

### 8.1 SQL注入测试
- 在用户名或密码字段中尝试SQL注入攻击
- 系统应能正确防御此类攻击

### 8.2 XSS攻击测试
- 在用户输入字段中尝试XSS攻击
- 返回的数据应对特殊字符进行转义

### 8.3 密码安全测试
- 密码应加密存储，不得以明文形式保存
- 密码传输过程中应通过HTTPS加密

## 9. 兼容性测试建议

### 9.1 不同设备类型测试
- 测试不同操作系统下的接口调用
- 确保接口在各种环境下都能正常工作

### 9.2 不同网络环境测试
- 模拟弱网环境下的接口调用
- 确保在网络不稳定的情况下有合理的错误处理机制